<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Comparatif ARENH – papernest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #f9fafb;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, sans-serif;
      display: flex; justify-content: center; align-items: flex-start;
      padding: 40px 16px;
    }
    .chart-wrapper {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
      padding: 24px 20px;
      max-width: 940px; 
      width: 100%;
    }
    h1 {
      margin: 0 0 20px; text-align: center;
      font-size: 22px; font-weight: 600; color: #5a52ff;
    }
    canvas { width: 100% !important; height: auto !important; }
  </style>
</head>
<body>
  <div class="chart-wrapper">
    <h1 style="font-family: 'Avenir', 'Poppins', 'Inter', sans-serif;">
      Prix électricité — Avec vs Sans ARENH
    </h1>

    <canvas id="myChart" aria-label="Comparatif ARENH" role="img"></canvas>
  </div>

  

  <script>
    // URL brute GitHub Pages
    const jsonUrl = "https://raw.githubusercontent.com/FEPPN/Graph/main/data.json";

    // Utilitaire : accepte nouveau ET ancien schéma
    const pick = (obj, keys) => {
      for (const k of keys) {
        if (obj[k] !== undefined && obj[k] !== null && obj[k] !== "") return obj[k];
      }
      return undefined;
    };

    const toFr = (iso) => {
      // attend "YYYY-MM-DD"
      if (typeof iso !== "string") return String(iso ?? "");
      const [y,m,d] = iso.split("-");
      if (y && m && d) return `${d}/${m}/${y}`;
      // fallback
      try { return new Date(iso).toLocaleDateString('fr-FR'); } catch { return iso; }
    };

    fetch(jsonUrl, { cache: "no-store" })
      .then(r => {
        if (!r.ok) throw new Error("HTTP " + r.status);
        return r.json();
      })
      .then(rows => {
        // Normalise les données
        const labels = [];
        const withA  = [];
        const withoutA = [];

        rows.forEach(r => {
          const dateIso   = pick(r, ["Date", "date", "dateISO"]);
          const vWith     = Number(pick(r, ["withARENH", "with_arenh", "wARENH"]));
          const vWithout  = Number(pick(r, ["withoutARENH", "without_arenh", "woARENH"]));

          if (!dateIso || Number.isNaN(vWith) || Number.isNaN(vWithout)) return;

          labels.push(toFr(String(dateIso)));
          withA.push(vWith);
          withoutA.push(vWithout);
        });

        const ctx = document.getElementById("myChart").getContext("2d");

        // Dégradés papernest
        const gWith = ctx.createLinearGradient(0,0,0,280);
        gWith.addColorStop(0, "rgba(90, 82, 255, 0.35)");
        gWith.addColorStop(1, "rgba(90, 82, 255, 0)");

        const gWithout = ctx.createLinearGradient(0,0,0,280);
        gWithout.addColorStop(0, "rgba(15, 196, 178, 0.35)");
        gWithout.addColorStop(1, "rgba(15, 196, 178, 0)");

        new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "Avec ARENH",
                data: withA,
                borderColor: "#5a52ff",
                backgroundColor: gWith,
                pointRadius: 0,
                borderWidth: 1,
                fill: true,
                tension: 0.3,
              },
              {
                label: "Sans ARENH",
                data: withoutA,
                borderColor: "#0fc4b2",
                backgroundColor: gWithout,
                pointRadius: 0,
                borderWidth: 1,
                fill: true,
                tension: 0.3,
              }
            ]
          },
          options: {
            responsive: true,
            interaction: { mode: 'nearest', intersect: false },
            plugins: {
              legend: {
                position: "bottom",
                labels: { color: "#1f2937", font: { size: 13, weight: "600" } }
              },
              tooltip: {
                backgroundColor: "#fff",
                borderColor: "#e5e7eb", borderWidth: 1,
                titleColor: "#111827", bodyColor: "#4b5563",
                titleFont: { weight:'700' }, bodyFont: { weight:'500' },
                padding: 10, cornerRadius: 10,
                callbacks: {
                  label: (ctx) => `${ctx.dataset.label} : ${ctx.parsed.y.toFixed(4)} € / kWh`
                }
              }
            },
            scales: {
              y: {
                ticks: {
                  color: "#6b7280",
                  callback: v => `${Number(v).toFixed(3)} €`
                },
                grid: { color: "rgba(0,0,0,0.05)" }
              },
              x: {
                ticks: { color: "#6b7280", maxRotation: 0, autoSkip: true, maxTicksLimit: 10 },
                grid: { display: false }
              }
            }
          }
        });
      })
      .catch(err => {
        console.error("Erreur chargement JSON:", err);
        document.querySelector(".chart-wrapper").insertAdjacentHTML(
          "beforeend",
          `<p style="margin-top:12px;color:#ef4444;text-align:center">Erreur de chargement des données.</p>`
        );
      });
  </script>
</body>
</html>

